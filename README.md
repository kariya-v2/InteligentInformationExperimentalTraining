# 1. 目的と完成条件
## 1.1 目的

  WSL2 上に Docker を用いて Pi-hole サーバーを構築し、LAN 内（またはローカルホスト）のブラウザ広告をネットワークレベルで遮断する。

## 1.2 完成条件

- 管理画面へのアクセス: ブラウザで http://localhost:8080/admin にアクセスし、Pi-holeのダッシュボードが表示されること。

- DNS名前解決の成功: ターミナルで nslookup コマンドを実行し、Pi-hole経由で正しいIPアドレスが返ってくること。

- 広告ドメインの拒否: 既知の広告ドメインを問い合わせた際、IPアドレスが 0.0.0.0（またはブロック用IP）として返されること。


# 2. 全体構成図とポート設計

## 2.1 全体構成図
本システムは、Windows 11上の WSL2 (Ubuntu 22.04 LTS) 内で動作する Dockerコンテナ として構築します。クライアント（ブラウザやアプリ）からのDNSリクエストをPi-holeコンテナが受け取り、広告ドメインであればブロック、正規のドメインであれば上位のDNSサーバー（Google DNSなど）へ転送する仕組みです。Host: Windows 11 / WSL2 (Ubuntu 22.04)Container: Pi-hole (Official Docker Image)Upstream DNS: Google Public DNS ($8.8.8.8$) または Cloudflare ($1.1.1.1$)

## 2.2 ポート設計
Pi-holeを正常に動作させるため、ホスト（WSL2）とコンテナ間で以下のポートをマッピングします。

| ホスト側ポート                          | コンテナ側ポート                                         | プロトコル          |用途        |
| :---------------------------- | :------------------------------------------- | :------------------- |:--------------------|
| 53                    | 53                                 | UDP/TCP`             |DNSサービス: 名前解決のリクエストを受け付ける最重要ポート。|
| 8080       | 80           | TCP   |管理画面 (Web UI): ブラウザから設定・統計を確認するためのポート。|
| 443 (任意)                    |443             | TCP |HTTPS: Webインターフェースの暗号化用（本構成では基本HTTPを使用）。
| 

#### **[!IMPORTANT]**
ポート53の競合について
多くのLinuxディストリビューション（Ubuntu等）では、デフォルトで systemd-resolved というサービスがポート53を使用しています。このままではPi-holeを起動できないため、次章以降の「事前準備」でこの競合を解消する設定を行います。

## 2.3 データの永続化
コンテナを削除しても設定やログが消えないよう、ホスト上のディレクトリをコンテナ内にマウントします。

- `./etc-pihole/` → `/etc/pihole/`: 広告リストや基本設定を保存

- `./etc-dnsmasq.d/` → `/etc/dnsmasq.d/`: DNSサーバー（dnsmasq）の詳細設定を保存

# 3. 前提条件と事前準備
## 3.1 実行環境（前提条件）
本手順書は、以下の環境で動作を確認しています。これらを用意してください。

- OS: Windows 11 Pro / Home (22H2以上推奨)

- プラットフォーム: WSL2 (Windows Subsystem for Linux 2)

- ディストリビューション: Ubuntu 22.04 LTS

- ネットワーク: インターネット接続環境（固定IPは不要だが、WSL内のIP確認が必要）

## 3.2 手順①：WSL2とUbuntuのセットアップ
まだWSL2を導入していない場合は、Windowsターミナル（PowerShell）を管理者権限で開き、以下のコマンドを実行します。

```python
# WSL2とUbuntuのインストール
wsl --install -d Ubuntu-22.04

# インストール後、PCを再起動し、ユーザー名・パスワードを設定してください。
```